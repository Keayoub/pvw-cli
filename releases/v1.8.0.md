# Release v1.8.0 - Idempotent Term Import & Custom Attributes Support

**Release Date:** February 6, 2026  
**Status:** ‚úÖ Production Ready  
**Previous Release:** [v1.7.2](v1.7.2.md) (January 27, 2026)

---

## üéØ Overview

v1.8.0 consolidates critical improvements to the **Unified Catalog Term Import system**, delivering idempotent operations and robust custom attributes handling. This release ensures that term imports are safe for re-execution, eliminating duplicate terms and guaranteeing custom attributes are properly applied.

### Key Statistics

- **Idempotent Term Import** - No more duplicate terms on re-import
- **Custom Attributes Support** - Full support with automatic 2-step creation (CREATE + UPDATE)
- **Enhanced Attribute Handling** - Improved support for custom attributes with spaces
- **Zero Breaking Changes** - Fully backward compatible

---

## ‚ú® What's New

### üÜï Idempotent Term Import - No More Duplicates

**Problem Solved:**
When running the same term import twice with the same data, terms were being duplicated instead of updated.

**Solution:**
v1.8.0 introduces support for the `term_id` column in CSV imports, enabling idempotent operations.

**CLI Command:**
```bash
# Import with term_id for idempotent updates
pvw uc term import-csv --f terms.csv

# Re-run the same command - terms are UPDATED, not duplicated ‚úì
pvw uc term import-csv --f terms.csv
```

**CSV Format Example:**
```csv
term_id,name,description,status,owner_ids,customAttributes.Glossaire.Reference
#DEMO_01#NA#Client#,Client,Customer entity,Draft,<uuid>,REF-001
#DEMO_02#NA#Product#,Product,Product catalog,Draft,<uuid>,REF-002
```

**Column Name Variations:**
The system recognizes multiple column name formats for term IDs:
- `term_id`, `id`, `ID`, `Term ID`, `TermId`

**Features:**
- ‚úÖ Primary lookup by `term_id` (most reliable)
- ‚úÖ Fallback to `--update-existing` flag for name-based matching
- ‚úÖ Safe for repeated execution
- ‚úÖ No duplicate terms created

**Use Cases:**
- Scheduled automated imports
- CI/CD pipeline term synchronization
- Safe re-runs without manual deduplication
- Term catalog maintenance and updates

---

### üéØ Custom Attributes Support - Complete Coverage

**Problem Solved:**
Custom attributes from CSV were being parsed but not applied to terms.

**Root Cause:**
Purview API requires a 2-step process: CREATE term first, then UPDATE with custom attributes.

**Solution:**
v1.8.0 implements automatic 2-step processing when `term_id` is provided or `--update-existing` flag is set.

**2-Step Process:**
```
Step 1: CREATE term with basic fields
        (name, description, status, owner_ids)

Step 2: UPDATE term to add custom attributes
        (managedAttributes API endpoint)

Result: Complete term with all custom attributes ‚úì
```

**CSV Format Example:**
```csv
term_id,name,description,customAttributes.Glossaire.Reference,customAttributes.Domain.Classification
#T001#,Client,Customer entity,REF-001,PII
#T002#,Product,Product data,REF-002,SENSITIVE
```

**Behavior Matrix:**

| Scenario | Behavior |
|----------|----------|
| CSV has `term_id` + custom attributes | CREATE + UPDATE (custom attributes applied) ‚úì |
| CSV has no `term_id`, use `--update-existing` | CREATE + UPDATE (custom attributes applied) ‚úì |
| CSV has no `term_id`, no flags | CREATE only (custom attributes NOT applied) ‚ö†Ô∏è |
| Re-import same CSV with `term_id` | UPDATE only - custom attributes preserved ‚úì |

**Features:**
- ‚úÖ Automatic 2-step creation
- ‚úÖ Support for multiple custom attributes per term
- ‚úÖ Attributes with spaces now properly handled
- ‚úÖ All attributes created on first import and updates

**Use Cases:**
- Rich term metadata with custom classifications
- Governance and compliance attributes
- Domain-specific term properties
- Multi-attribute term management

---

### üîß Enhanced Custom Attribute Handling

**Improvements:**
- Better parsing of custom attribute names containing spaces
- Robust handling of special characters in attribute values
- Ensures all custom attributes are created, even with complex formats
- Improved error messages for debugging attribute issues

**Technical Updates:**
- Enhanced attribute parsing logic in `purviewcli/cli/unified_catalog.py`
- Improved attribute creation in `purviewcli/client/_unified_catalog.py`
- Better validation of attribute names and values

---

### üìã CI/CD Improvements

**PyPI Publish Workflow Update:**
- Fixed GitHub Actions workflow to trigger on version tags (`v*`)
- Instead of requiring a separate release branch
- Streamlined deployment process
- Automated package publication on tag creation

**Benefit:**
Simply creating a version tag (`v1.8.0`) now automatically triggers package building and PyPI publication without manual intervention.

---

## üöÄ Migration Guide

### For Existing CSV Imports

**Option 1: Add term_id column (Recommended)**
```bash
# Before: only name and description
name,description
Client,Customer entity
Product,Product catalog

# After: add term_id for idempotence
term_id,name,description
#T001#,Client,Customer entity
#T002#,Product,Product catalog
```

**Option 2: Use --update-existing flag**
```bash
# Re-import with name-based matching
pvw uc term import-csv --f terms.csv --update-existing
```

### Adding Custom Attributes

Include custom attribute columns in CSV using dot notation:
```csv
term_id,name,description,customAttributes.Domain.Classification,customAttributes.Glossaire.Reference
#T001#,Client,Customer entity,PII,REF-001
```

---

## üì¶ Technical Details

### Files Changed
- `purviewcli/cli/unified_catalog.py` - Enhanced CSV parsing and import logic
- `purviewcli/client/_unified_catalog.py` - Improved custom attribute handling
- `.github/workflows/publish-to-pypi.yml` - PyPI trigger fix

### Backward Compatibility
‚úÖ **Fully backward compatible**
- Existing CSV files without `term_id` still work
- `--update-existing` flag continues to work as before
- No breaking changes to CLI commands or API

---

## üêõ Bug Fixes Summary

1. **Duplicate Terms on Re-import** - Fixed via `term_id` column support
2. **Custom Attributes Not Applied** - Fixed via 2-step CREATE + UPDATE process
3. **Attributes with Spaces** - Fixed parsing and creation logic
4. **PyPI Workflow** - Fixed trigger conditions for automated publishing

---

## üìà What's Next

Future releases may include:
- UI for custom attribute definition
- Bulk attribute updates
- Attribute validation rules
- Term relationship import via CSV

---

## üì• Installation

Update to v1.8.0:
```bash
pip install --upgrade pvw-cli
```

Or for development:
```bash
git checkout v1.8.0
pip install -e .
```

---

## üîó Related Documentation

- [FIXES_IMPORT_IDEMPOTENCE.md](../FIXES_IMPORT_IDEMPOTENCE.md) - Technical implementation details
- [Unified Catalog API Guide](../doc/integrated/UC_API_GUIDE.md) - Complete UC API reference
- [UC API Coverage Analysis](../doc/UC_API_COVERAGE_ANALYSIS.md) - API coverage tracking

---

## üìù Version Information

**Version:** 1.8.0  
**Tag:** v1.8.0  
**Commit:** 24cb5248  
**Date:** February 6, 2026  
**Status:** ‚úÖ Production Ready
