# v1.5.3 Release Notes

## Critical Fix: Custom Attributes (Managed Attributes) Support

### Breaking Discovery & Fix
**Issue Found**: Initial v1.5.3 implementation used incorrect API field (`customAttributes`) instead of `managedAttributes`
**Resolution**: Complete rewrite to use correct Purview Unified Catalog API structure

### Custom Attributes Support for Unified Catalog Terms

#### Import Custom Attributes via CSV
- **Feature**: `pvw uc term import-csv` now supports custom attributes (managed attributes)
- **Syntax**: Use dot notation in CSV column headers
  - Flat: `customAttributes.fieldName`
  - Nested: `customAttributes.Group.Field`
  - Multi-level: `customAttributes.Group.SubGroup.Field`

**Example CSV:**
```csv
name,description,status,customAttributes.DataProductGovernance.BusinessDomain,customAttributes.DataProductGovernance.ComplianceStatus,customAttributes.DataProductGovernance.ProductOwner
Product Alpha,First product term,Draft,Sales,Compliant,Alice Johnson
Product Beta,Second product term,Draft,Marketing,Pending,Bob Smith
```

**Result**: All 3 terms created with custom attributes successfully applied

#### Update Custom Attributes via CLI
- **Feature**: `pvw uc term update` now accepts `--custom-attributes` parameter with `--debug` flag
- **Usage**: `pvw uc term update --term-id <id> --custom-attributes '<json>' --debug`

**Example:**
```bash
pvw uc term update --term-id abc123 --custom-attributes '{"DataProductGovernance": {"BusinessDomain": "Finance", "ComplianceStatus": "Approved"}}'
```

#### Update Custom Attributes via CSV
- **Feature**: `pvw uc term update-csv` now supports nested custom attributes
- **Syntax**: Same dot notation as import-csv

**Example CSV:**
```csv
term_id,name,description,customAttributes.DataProductGovernance.BusinessDomain,customAttributes.DataProductGovernance.ComplianceStatus
abc123,Product Updated,New description,IT,Approved
```

### Technical Implementation

**API Conversion Process:**
1. User provides nested JSON: `{"DataProductGovernance": {"BusinessDomain": "Finance"}}`
2. CLI converts to `managedAttributes` array format: `[{"name": "DataProductGovernance.BusinessDomain", "value": "Finance"}]`
3. API accepts and persists correctly

**Import Process:**
1. CREATE term (API doesn't support managedAttributes on POST)
2. UPDATE term automatically to add managedAttributes
3. Transparent 2-step process with success confirmation

**Custom Attribute Format:**
- **Input (CSV/JSON)**: Nested structure `{"Group": {"Field": "value"}}`
- **API Format**: Flat array with dot notation `[{"name": "Group.Field", "value": "value"}]`
- **Automatic conversion** handles all transformation
- Supports unlimited nesting levels

**Debug Mode:**
- Use `--debug` flag to see payload structures
- Shows parsed custom attributes at each step
- Displays full JSON sent to API for troubleshooting

## Bug Fixes

### Fixed Entity Bulk Update
- Fixed name collision where Python `list()` builtin was shadowed by Click command
- Entity `bulk-update-csv` now works correctly

### Improvements

- Enhanced error handling for custom attributes parsing
- Better logging and debugging information
- More robust nested attribute structure creation

## Testing Results

**Verified Operations:**

✅ **import-csv**: 3 terms created successfully
- Product Alpha (Sales/Compliant/Confidential/Alice Johnson)  
- Product Beta (Marketing/Pending/Public/Bob Smith)
- Product Gamma (Finance/Approved/Internal/Carol White)
- All custom attributes persisted correctly in API

✅ **update-csv**: 2 terms updated successfully  
- Product Alpha → IT/Approved/David Brown (BusinessDomain, ComplianceStatus, ProductOwner changed)
- Product Beta → Operations/Compliant/Emma Davis (updated attributes, preserved unchanged ones)
- Merge logic working correctly

✅ **API Verification**: 
- GET requests confirm `managedAttributes` present with correct values
- Format: `[{"name": "Group.Field", "value": "..."}]`
- All attributes queryable and displayed in Purview UI

## Technical Notes

### API Behavior & Format
- **Critical**: Purview UC API uses `managedAttributes` (array) not `customAttributes` (object)
- **Format**: Flat list with dot notation: `[{"name": "Group.Field", "value": "X"}]`
- **Creation**: API doesn't support managedAttributes on POST (term creation)
- **Update**: managedAttributes only accepted via PUT (term update)
- **Retrieval**: GET returns managedAttributes in same array format
- **UI Display**: Purview UI shows custom attributes under "Custom attributes" section

### Supported Formats

**Custom Attribute Groups Tested:**
- `DataProductGovernance` (BusinessDomain, ComplianceStatus, DataClassification, ProductOwner)
- `Glossaire` (Reference)
- Any custom attribute group defined in governance domain

**Nesting Levels:**
- Unlimited depth supported
- Example: `customAttributes.Group.SubGroup.Field.SubField`
- Auto-converts to: `Group.SubGroup.Field.SubField` in managedAttributes

## Testing

All features tested and verified:
- ✅ Single term import with custom attributes
- ✅ Bulk import (3 terms) with 4 custom attribute fields
- ✅ Bulk update (2 terms) with partial custom attribute changes
- ✅ Merge preserves unchanged attributes
- ✅ API GET confirms persistence
- Multiple custom attribute groups simultaneously
- Nested attributes with 2-3 levels
- Domain: `bc785cdb-11c3-4227-ab44-f6ad44048623`

## Version Info
- **Version**: 1.5.3
- **Release Date**: 2026-01-19
- **Python**: 3.8+
- **Dependencies**: No new dependencies

## Migration Guide

### From v1.5.2
No breaking changes. All existing commands continue to work.

New optional parameters:
- `pvw uc term update --custom-attributes <json>` (new)
- `--debug` flag for troubleshooting

## Known Limitations

1. **API Limitation**: Custom attributes cannot be set during term creation, only via update
2. **Value Verification**: API GET doesn't return custom attribute values; must verify in Purview UI
3. **Performance**: Import with custom attributes is slower (requires CREATE + UPDATE per term)

## Examples

### Example 1: Import Terms with Multiple Custom Attribute Groups

```bash
# Create CSV file: glossaire_terms.csv
# Headers: name,description,customAttributes.Glossaire.Reference,customAttributes.DataProductGovernance.BusinessDomain
# Row: Term1,Description,REF-001,Finance

pvw uc term import-csv --domain-id 'bc785cdb-11c3-4227-ab44-f6ad44048623' --csv-file glossaire_terms.csv
```

### Example 2: Update Existing Term Custom Attributes

```bash
pvw uc term update --term-id 'abc-123-def' --custom-attributes '{
  "DataProductGovernance": {
    "BusinessDomain": "Finance",
    "ComplianceStatus": "Approved",
    "DataClassification": "PII"
  }
}'
```

### Example 3: Bulk Update with CSV

```bash
# Create CSV: updates.csv
# Headers: term_id,customAttributes.DataProductGovernance.BusinessDomain,customAttributes.DataProductGovernance.ComplianceStatus
# Rows: term-1,Finance,Compliant
#       term-2,Sales,Approved

pvw uc term update-csv --csv-file updates.csv
```

## Contributors
- Ayoub Keayoub

## Questions or Issues?
Please report issues on GitHub with:
- Custom attributes structure
- Custom attribute values not appearing in UI
- CSV format questions
