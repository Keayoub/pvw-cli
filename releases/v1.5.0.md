# Version 1.5.0 - Legacy Tenant Authentication Support

Release Date: 2026-01-13  
Type: Minor Feature + Authentication Fix

## Highlights
- **Authentication Scope Override**: Added support for legacy Azure tenants using `https://purview.azure.net` service principal
- **Environment Variable Configuration**: New `PURVIEW_AUTH_SCOPE` environment variable allows custom authentication scope
- **Documentation Enhancement**: Comprehensive guide added to detect and configure authentication scope for different tenant types

## What's New

### Authentication Flexibility
Some Azure environments (legacy tenants, test environments, special government clouds) still use the legacy Purview service principal (`https://purview.azure.net`) instead of the modern one (`https://purview.azure.com`). This release adds full support for these environments.

### New Environment Variable
```bash
# For legacy tenants using purview.azure.net
export PURVIEW_AUTH_SCOPE="https://purview.azure.net/.default"

# For modern tenants (default, no configuration needed)
export PURVIEW_AUTH_SCOPE="https://purview.azure.com/.default"
```

### Tenant Detection
Users can now detect which service principal their tenant uses:

```powershell
# Check your tenant's Purview service principal
az ad sp show --id "73c2949e-da2d-457a-9607-fcc665198967" --query "servicePrincipalNames" -o json
```

Look for:
- `https://purview.azure.com` → Use `.com` (default)
- `https://purview.azure.net` → Use `.net` (set PURVIEW_AUTH_SCOPE)

## Technical Details

### Code Changes
- Modified `purviewcli/client/sync_client.py` to support `PURVIEW_AUTH_SCOPE` environment variable
- Authentication scope now respects environment configuration while maintaining backward compatibility
- Default behavior unchanged: uses `https://purview.azure.com/.default` for public cloud

### Error Resolution
This release resolves authentication errors for legacy tenants:
```
AADSTS500011: The resource principal named https://purview.azure.com was not found in the tenant
```

## Documentation Updates
- Added comprehensive authentication scope detection guide to README.md
- Included platform-specific examples for Windows (PowerShell, CMD) and Linux (Bash)
- Added troubleshooting section for authentication errors

## Backward Compatibility
✅ **Fully backward compatible**
- No breaking changes
- Default behavior unchanged for modern tenants
- Only requires configuration if using legacy service principal

## Migration Guide

### For Legacy Tenants (purview.azure.net)
```powershell
# PowerShell
$env:PURVIEW_AUTH_SCOPE = "https://purview.azure.net/.default"

# Add to profile for persistence
Add-Content $PROFILE "`n`$env:PURVIEW_AUTH_SCOPE = 'https://purview.azure.net/.default'"
```

```bash
# Bash/Linux
export PURVIEW_AUTH_SCOPE="https://purview.azure.net/.default"

# Add to ~/.bashrc for persistence
echo 'export PURVIEW_AUTH_SCOPE="https://purview.azure.net/.default"' >> ~/.bashrc
```

### For Modern Tenants
No action required - works out of the box!

## Affected Components
- `purviewcli/client/sync_client.py` - Added environment variable support
- `README.md` - Added detection and configuration guide
- Authentication flow - Enhanced to support multiple service principal types

## Testing
- ✅ Tested with legacy tenant using `purview.azure.net`
- ✅ Tested with modern tenant using `purview.azure.com`
- ✅ Verified backward compatibility
- ✅ Confirmed environment variable override works correctly

## Known Considerations
- Most modern Azure tenants use `https://purview.azure.com` (default)
- Legacy service principal `https://purview.azure.net` is specific to:
  - Older Azure environments
  - Test/development tenants
  - Some government cloud configurations
  - Special customer configurations

## Thanks
Thanks to the community for reporting authentication issues with legacy tenant configurations. This release ensures pvw-cli works seamlessly across all Azure Purview environments.

## Installation

### Upgrade from PyPI
```bash
pip install --upgrade pvw-cli
```

### Install from source
```bash
pip install git+https://github.com/Keayoub/Purview_cli.git
```

## Verify Installation
```bash
pvw --version
# Should output: pvw-cli version 1.5.0
```

## References
- Microsoft Purview App ID: `73c2949e-da2d-457a-9607-fcc665198967`
- [Authentication Guide](../doc/guides/authentication.md)
- [Quick Start Guide](../README.md#quick-start)
