# Release v1.2.8 - OKR Key Results Management

**Release Date:** November 5, 2025  
**Version:** 1.2.8  
**Previous Version:** 1.2.7

[![Version](https://img.shields.io/badge/version-1.2.8-blue.svg)](https://github.com/Keayoub/pvw-cli/releases/tag/v1.2.8)
[![OKR](https://img.shields.io/badge/OKR-Key%20Results-green.svg)](https://github.com/Keayoub/pvw-cli)
[![Status](https://img.shields.io/badge/status-stable-success.svg)](https://github.com/Keayoub/pvw-cli)

---

## ğŸ¯ Overview

Version 1.2.8 completes the **Microsoft Purview Data Governance API** integration by exposing **Key Results (OKR) management** via CLI. This release closes the gap between the API capabilities and user-accessible features, bringing API coverage from 85% to 92%.

**Key Features:**
- **Full Key Results CLI** with 5 commands (list, show, create, update, delete)
- **Rich table formatting** for better readability
- **JSON output mode** for automation and scripting
- **Confirmation prompts** for destructive operations
- **Comprehensive documentation** with examples and best practices

---

## ğŸŒŸ Highlights

### ğŸ¯ Key Results Management

**New CLI Commands:**

```powershell
# List key results for an objective
pvw uc keyresult list --objective-id <guid>

# Show detailed information
pvw uc keyresult show --objective-id <guid> --key-result-id <guid>

# Create a new key result
pvw uc keyresult create \
  --objective-id <guid> \
  --governance-domain-id <domain-guid> \
  --definition "Reduce data validation errors" \
  --progress 5 \
  --goal 25 \
  --max 100 \
  --status OnTrack

# Update progress
pvw uc keyresult update \
  --objective-id <guid> \
  --key-result-id <guid> \
  --governance-domain-id <domain-guid> \
  --progress 15 \
  --status OnTrack

# Delete with confirmation
pvw uc keyresult delete --objective-id <guid> --key-result-id <guid>
pvw uc keyresult delete --objective-id <guid> --key-result-id <guid> -y  # Skip confirmation
```

---

## âœ¨ New Features

### 1. Key Results CLI Commands

**Five Complete Commands:**

| Command | Purpose | Key Options |
|---------|---------|-------------|
| `list` | Display all key results for an objective | `--objective-id`, `--json` |
| `show` | Show detailed JSON for a key result | `--objective-id`, `--key-result-id` |
| `create` | Create new key result | `--definition`, `--goal`, `--progress`, `--status` |
| `update` | Update existing key result | All fields (PUT behavior) |
| `delete` | Delete key result | `--yes` for auto-confirmation |

**Status Options:**
- `OnTrack` - Progress is on target
- `AtRisk` - Behind schedule, needs attention
- `OffTrack` - Significantly behind
- `Completed` - Goal achieved

### 2. Rich Table Output

Key results are displayed in a beautiful, easy-to-read table:

```
                Key Results for Objective eee75858...                
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”³â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”“
â”ƒ ID           â”ƒ Definition                    â”ƒ Progress â”ƒ Goal â”ƒ Max â”ƒ Status  â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â•‡â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”©
â”‚ 8dd15c5b-... â”‚ Reduce data validation err... â”‚ 15.0     â”‚ 25.0 â”‚ 100 â”‚ OnTrack â”‚
â”‚ b0859094-... â”‚ Reduce average data refresh...â”‚ 55.0     â”‚ 100  â”‚ 100 â”‚ AtRisk  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. JSON Output for Automation

Perfect for PowerShell scripting and automation:

```powershell
# Get all key results as JSON
$keyResults = pvw uc keyresult list --objective-id $objId --json | ConvertFrom-Json

# Filter by status
$atRisk = $keyResults | Where-Object { $_.status -eq "AtRisk" }

# Calculate completion percentage
$keyResults | ForEach-Object {
    $pct = ($_.progress / $_.goal) * 100
    Write-Host "$($_.definition): $pct%"
}
```

### 4. Safety Features

- **Confirmation prompts** for delete operations
- **Input validation** for status values
- **Clear error messages** with actionable guidance
- **Dry-run indicators** in documentation

---

## ğŸ”§ Technical Changes

### Modified Files

1. **`purviewcli/client/endpoints.py`**
   - Added 5 Key Results endpoint definitions
   - Lines 415-420: `list_key_results`, `get_key_result`, `create_key_result`, `update_key_result`, `delete_key_result`

2. **`purviewcli/cli/unified_catalog.py`**
   - Added complete `keyresult` command group (~240 lines)
   - Rich table formatting with proper column names
   - JSON output mode support
   - Status validation and error handling

3. **`doc/keyresult-commands-quickstart.md`**
   - Updated with correct API parameter names
   - Added PUT behavior warnings
   - Complete workflow examples
   - PowerShell integration samples

### API Coverage Improvement

- **Before:** 85-90% coverage of Data Governance API
- **After:** 92% coverage
- **Gap Closed:** Key Results (5 operations)

---

## ğŸ“‹ Testing

All commands were tested against a live Microsoft Purview instance:

âœ… **list** - Displays key results in rich table format  
âœ… **show** - Returns complete JSON details  
âœ… **create** - Successfully creates with all parameters  
âœ… **update** - Updates fields (requires all fields due to PUT)  
âœ… **delete** - Safely deletes with confirmation prompt  

### Test Environment
- **Instance:** Live Microsoft Purview  
- **Domain:** Finance (d8209808-ae13-47cd-8e38-4e2932dce8a7)
- **Objective:** "Improve Data Quality" (eee75858-bab0-4e83-a0d3-1fd0a817ecc5)
- **Key Results Created:** 3
- **Operations Tested:** All CRUD operations

---

## ğŸ“š Documentation

### New Files Created

1. **`doc/keyresult-commands-quickstart.md`** (437 lines)
   - Quick start guide with examples
   - Command syntax reference
   - PowerShell integration patterns
   - Best practices and warnings

2. **`doc/keyresult-implementation-summary.md`** (445 lines)
   - Technical implementation details
   - Testing checklist
   - Rollback procedures
   - Architecture documentation

3. **`doc/data-governance-api-gap-analysis.md`** (350+ lines)
   - Comprehensive API coverage analysis
   - Implementation status by operation group
   - Priority recommendations
   - Future roadmap

---

## ğŸ› Bug Fixes

### Fixed Parameter Mapping

**Issue:** CLI parameters didn't match client method expectations  
**Impact:** Create and update commands failed with 400 errors  
**Fix:** Aligned CLI parameters with API requirements:
- `name` â†’ `definition`
- `target-value`/`current-value` â†’ `goal`/`progress`
- Added required `governance-domain-id` parameter
- Added `max` parameter for percentage calculations

### Fixed Table Display

**Issue:** List command showed "N/A" for all fields  
**Impact:** Users couldn't see key result data  
**Fix:** Updated column names to match API response structure:
- `name` â†’ `definition`
- `targetValue` â†’ `goal`
- `currentValue` â†’ `progress`
- Added `max` column

---

## âš ï¸ Known Issues

### 1. Update Command PUT Behavior

**Issue:** Update uses HTTP PUT, which requires all fields  
**Impact:** If you omit optional fields, they will be cleared  
**Workaround:** Always provide all fields when updating  
**Status:** API design limitation, not a bug

**Example:**
```bash
# BAD - Will clear definition and other fields
pvw uc keyresult update --objective-id $id --key-result-id $kr --progress 20

# GOOD - Preserves all fields
pvw uc keyresult update \
  --objective-id $id \
  --key-result-id $kr \
  --governance-domain-id $domain \
  --definition "Original definition text" \
  --progress 20 \
  --goal 25 \
  --max 100
```

### 2. API Eventual Consistency

**Issue:** Newly created key results may not immediately appear in list  
**Impact:** Delay of 1-2 seconds before item is visible  
**Workaround:** Use `show` command to verify creation, or wait briefly before listing  
**Status:** Expected behavior with distributed systems

---

## ğŸ”„ Migration Guide

### From v1.2.7 to v1.2.8

No breaking changes. This release adds new functionality only.

**New Commands Available:**
```bash
pvw uc keyresult --help  # View all key result commands
```

**No Changes Required For:**
- Existing scripts
- Configuration files
- Authentication methods
- Other CLI commands

---

## ğŸ“ Usage Examples

### Complete OKR Workflow

```powershell
# 1. Get domain ID
$domains = pvw uc domain list --json | ConvertFrom-Json
$finDomain = $domains | Where-Object { $_.name -eq "Finance" }

# 2. Create objective
$obj = pvw uc objective create `
  --domain-id $finDomain.id `
  --definition "Improve Data Quality by 25%" `
  --target-date 2025-12-31T23:59:59.000Z `
  --status Draft | ConvertFrom-Json

# 3. Create key results
pvw uc keyresult create `
  --objective-id $obj.id `
  --governance-domain-id $finDomain.id `
  --definition "Reduce validation errors" `
  --progress 5 --goal 25 --status OnTrack

pvw uc keyresult create `
  --objective-id $obj.id `
  --governance-domain-id $finDomain.id `
  --definition "Complete lineage docs" `
  --progress 12 --goal 50 --max 50 --status OnTrack

# 4. Monitor progress
pvw uc keyresult list --objective-id $obj.id

# 5. Update progress weekly
pvw uc keyresult update `
  --objective-id $obj.id `
  --key-result-id $krId `
  --governance-domain-id $finDomain.id `
  --definition "Reduce validation errors" `
  --progress 15 --goal 25 --status OnTrack
```

---

## ğŸš€ What's Next

### Remaining API Gaps (Future Releases)

1. **Facets Endpoints** (4 operations)
   - Advanced analytics and aggregations
   - Priority: Low (niche use case)

2. **Term Hierarchy** (2 operations)
   - Navigate parent-child term structures
   - Priority: Medium

3. **Related Entities** (2 operations)
   - Cross-reference governance objects
   - Priority: Medium

4. **Delete Related Term** (1 operation)
   - Remove term associations
   - Priority: Low

---

## ğŸ“¦ Installation

### Upgrade from v1.2.7

```bash
# Via pip
pip install --upgrade purview-cli

# Via git
cd pvw-cli
git pull origin main
pip install -e .
```

### Fresh Install

```bash
pip install purview-cli
```

---

## ğŸ™ Acknowledgments

This release completes the Data Governance API integration milestone, providing comprehensive OKR management capabilities to Purview users. Special thanks to the testing efforts that identified the parameter mapping issues.

---

## ğŸ“Š Stats

- **Lines Added:** ~240 (CLI) + 5 (endpoints) + 1,300 (documentation)
- **Commands Added:** 5
- **Test Coverage:** Live instance validation
- **API Coverage:** 92% (up from 85%)
- **Documentation:** 3 new guides

---

## ğŸ”— Links

- [GitHub Repository](https://github.com/Keayoub/pvw-cli)
- [Key Results Quick Start](../doc/keyresult-commands-quickstart.md)
- [Implementation Summary](../doc/keyresult-implementation-summary.md)
- [Gap Analysis](../doc/data-governance-api-gap-analysis.md)

---

**Full Changelog:** [v1.2.7...v1.2.8](https://github.com/Keayoub/pvw-cli/compare/v1.2.7...v1.2.8)
