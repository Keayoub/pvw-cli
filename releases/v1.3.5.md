# Version 1.3.5 - Lineage Relationship Types Verification & Correction

**Date de release** : 2025-11-14  
**Type** : Bug Fix & Documentation

## ğŸ› Corrections

### Lineage Relationship Types - Validation complÃ¨te

Suite Ã  une vÃ©rification approfondie avec la documentation officielle Microsoft, nous avons corrigÃ© la liste des types de relations de traÃ§abilitÃ© supportÃ©s.

#### ProblÃ¨me identifiÃ©

Le code contenait **2 types de relations invalides** qui n'existent pas dans l'API Microsoft Purview :
- âŒ `dataset_process_outputs` (HTTP 404)
- âŒ `process_dataset_inputs` (HTTP 404)

#### Correction appliquÃ©e

**Fichier modifiÃ©** : `purviewcli/client/_lineage.py` (lignes 1004-1013)

**Avant** (5 types dont 2 invalides) :
```python
direct_relationship_types = [
    'direct_lineage_dataset_dataset',
    'dataset_process_inputs',
    'process_dataset_outputs',
    'dataset_process_outputs',    # INVALIDE
    'process_dataset_inputs'      # INVALIDE
]
```

**AprÃ¨s** (3 types officiels uniquement) :
```python
# List of official direct relationship types supported by Microsoft Purview
# Reference: https://learn.microsoft.com/en-us/purview/data-gov-api-create-lineage-relationships#concepts
direct_relationship_types = [
    'direct_lineage_dataset_dataset',  # DataSet â†’ DataSet (direct link)
    'dataset_process_inputs',          # DataSet â†’ Process (input)
    'process_dataset_outputs'          # Process â†’ DataSet (output)
]
```

### Types officiels validÃ©s

Selon la [documentation Microsoft](https://learn.microsoft.com/en-us/purview/data-gov-api-create-lineage-relationships#concepts), seuls **3 types de relations** existent :

| Type | Direction | Description | Statut Test |
|------|-----------|-------------|-------------|
| `dataset_process_inputs` | DataSet â†’ Process | Le DataSet est l'entrÃ©e du Process | âœ… VALIDÃ‰ |
| `process_dataset_outputs` | Process â†’ DataSet | Le Process produit le DataSet | âœ… VALIDÃ‰ |
| `direct_lineage_dataset_dataset` | DataSet â†’ DataSet | Lien direct sans Process visible | âœ… VALIDÃ‰ |

## âœ… Validation

### Tests effectuÃ©s

Tous les types ont Ã©tÃ© testÃ©s avec succÃ¨s :

```powershell
# Test dataset_process_inputs
py -m purviewcli lineage import test_lineage_types.csv
# RÃ©sultat: âœ… Relation crÃ©Ã©e (GUID: 7d380c5f-a1e1-442c-b1e8-8d1df352c0c1)

# Test process_dataset_outputs  
# RÃ©sultat: âœ… Relation crÃ©Ã©e (GUID: 3cc480c2-317a-4943-b3a3-636789fe608e)

# Test direct_lineage_dataset_dataset
py -m purviewcli lineage import test_direct_lineage.csv
# RÃ©sultat: âœ… Relation crÃ©Ã©e (GUID: 1e4fe5de-fcbc-40a6-b331-e65a831cee2f)
```

### VÃ©rification API

Chaque type a Ã©tÃ© vÃ©rifiÃ© contre l'API Purview :

```powershell
# Types valides (HTTP 200)
py -m purviewcli types read-relationship-def --name dataset_process_inputs
py -m purviewcli types read-relationship-def --name process_dataset_outputs
py -m purviewcli types read-relationship-def --name direct_lineage_dataset_dataset

# Types invalides (HTTP 404)
py -m purviewcli types read-relationship-def --name dataset_process_outputs
py -m purviewcli types read-relationship-def --name process_dataset_inputs
```

## ğŸ“š Documentation

### Nouveaux documents crÃ©Ã©s

1. **[Lineage Relationship Types Guide](../doc/guides/lineage-relationship-types.md)**
   - Guide complet des 3 types officiels
   - Exemples CSV dÃ©taillÃ©s
   - Structures de relations Atlas
   - Cas d'usage et patterns

2. **[Lineage Relationship Types Verification Report](../doc/lineage-relationship-types-verification.md)**
   - Rapport de vÃ©rification complet
   - Comparaison avant/aprÃ¨s
   - RÃ©sultats des tests avec GUIDs
   - Structures JSON des dÃ©finitions

3. **[Lineage API Quick Reference](../doc/lineage-quick-reference.md)**
   - RÃ©fÃ©rence rapide pour dÃ©veloppeurs
   - Commandes CLI essentielles
   - Patterns courants
   - RÃ©solution d'erreurs

4. **[Session Summary](../doc/session-lineage-types-verification.md)**
   - RÃ©sumÃ© dÃ©taillÃ© de la vÃ©rification
   - Commandes utilisÃ©es
   - MÃ©thodologie de validation

### Fichiers de test crÃ©Ã©s

- `test_lineage_types.csv` - Tests dataset_process_inputs et process_dataset_outputs
- `test_direct_lineage.csv` - Test direct_lineage_dataset_dataset
- `trace_corrected.csv` - Exemple de traÃ§abilitÃ© complÃ¨te

## ğŸ” DÃ©tails techniques

### Structure des relations

#### dataset_process_inputs
```json
{
  "typeName": "dataset_process_inputs",
  "relationshipCategory": "AGGREGATION",
  "propagateTags": "TWO_TO_ONE",
  "endDef1": {
    "type": "Process",
    "name": "inputs",
    "isContainer": true
  },
  "endDef2": {
    "type": "DataSet",
    "name": "inputToProcesses",
    "isContainer": false
  }
}
```

#### process_dataset_outputs
```json
{
  "typeName": "process_dataset_outputs",
  "relationshipCategory": "AGGREGATION",
  "propagateTags": "ONE_TO_TWO",
  "endDef1": {
    "type": "Process",
    "name": "outputs",
    "isContainer": true
  },
  "endDef2": {
    "type": "DataSet",
    "name": "outputFromProcesses",
    "isContainer": false
  }
}
```

#### direct_lineage_dataset_dataset
```json
{
  "typeName": "direct_lineage_dataset_dataset",
  "relationshipCategory": "ASSOCIATION",
  "propagateTags": "NONE",
  "endDef1": {
    "type": "DataSet",
    "name": "sinks",
    "isContainer": false
  },
  "endDef2": {
    "type": "DataSet",
    "name": "sources",
    "isContainer": false
  }
}
```

## ğŸ“Š Exemples d'utilisation

### Exemple 1 : DataSet â†’ Process â†’ DataSet

**Fichier CSV** :
```csv
source_entity_guid,target_entity_guid,source_type,target_type,relationship_type
4fae348b-e960-42f7-834c-38f6f6f60000,c8daf98e-3113-446b-91bf-894236c790c3,azure_sql_table,fabric_pipeline,dataset_process_inputs
c8daf98e-3113-446b-91bf-894236c790c3,ece43ce5-ac45-4e50-a4d0-365a64299efc,fabric_pipeline,fabric_data_warehouse,process_dataset_outputs
```

**Commande** :
```powershell
py -m purviewcli lineage import lineage.csv
```

**RÃ©sultat visuel** :
```
Azure SQL Table (Address)
    â†“ dataset_process_inputs
Fabric Pipeline (pipeline3)
    â†“ process_dataset_outputs
Fabric Data Warehouse
```

### Exemple 2 : Lien direct DataSet â†’ DataSet

**Fichier CSV** :
```csv
source_entity_guid,target_entity_guid,source_type,target_type,relationship_type
4fae348b-e960-42f7-834c-38f6f6f60000,2d21eba5-b08b-4571-b31d-7bf6f6f60000,azure_sql_table,azure_sql_table,direct_lineage_dataset_dataset
```

**Commande** :
```powershell
py -m purviewcli lineage import direct_lineage.csv
```

**RÃ©sultat visuel** :
```
Azure SQL Table (Address)
    â†“ direct_lineage_dataset_dataset
Azure SQL Table (CustomerAddress)
```

## ğŸ¯ Impact

### Avant la correction
- âœ… FonctionnalitÃ© : Code fonctionnel (les types invalides n'Ã©taient jamais utilisÃ©s)
- âš ï¸ ConformitÃ© : Liste non conforme Ã  la spÃ©cification officielle
- âš ï¸ Maintenance : Risque de confusion pour les dÃ©veloppeurs

### AprÃ¨s la correction
- âœ… FonctionnalitÃ© : Code inchangÃ©, toujours fonctionnel
- âœ… ConformitÃ© : 100% conforme Ã  la documentation Microsoft
- âœ… Maintenance : Code plus clair avec commentaires et rÃ©fÃ©rences
- âœ… Documentation : Guides complets pour les utilisateurs

## ğŸ”— RÃ©fÃ©rences

- [Create and get lineage relationships using the REST API](https://learn.microsoft.com/en-us/purview/data-gov-api-create-lineage-relationships#concepts)
- [Relationship API Documentation](https://learn.microsoft.com/en-us/rest/api/purview/datamapdataplane/relationship/create)
- [Type Definitions and Custom Types](https://learn.microsoft.com/en-us/purview/data-gov-api-custom-types)

## ğŸš€ Migration

### Pas d'action requise

Cette correction n'affecte pas les fonctionnalitÃ©s existantes :
- âœ… Les imports CSV existants continuent de fonctionner
- âœ… Aucune modification de l'API publique
- âœ… RÃ©trocompatibilitÃ© totale

### Pour les dÃ©veloppeurs

Si vous avez du code personnalisÃ© utilisant `dataset_process_outputs` ou `process_dataset_inputs`, notez que ces types **n'ont jamais existÃ©** dans l'API Purview. Utilisez les types officiels :
- `dataset_process_inputs` pour DataSet â†’ Process
- `process_dataset_outputs` pour Process â†’ DataSet
- `direct_lineage_dataset_dataset` pour DataSet â†’ DataSet

## ğŸ“ RÃ©sumÃ©

- ğŸ› **Correction** : Suppression de 2 types invalides de la liste
- âœ… **Validation** : Tests complets des 3 types officiels
- ğŸ“š **Documentation** : 4 nouveaux documents crÃ©Ã©s
- ğŸ¯ **ConformitÃ©** : 100% conforme Ã  Microsoft Purview API
- ğŸ”„ **CompatibilitÃ©** : Aucun changement breaking

---

**Version prÃ©cÃ©dente** : [v1.3.4](v1.3.4.md) - Synchronisation UC vers Glossaires Classiques  
**Prochaine version** : TBD
