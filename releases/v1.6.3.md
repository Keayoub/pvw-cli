# Release Notes - v1.6.3 (January 27, 2026)

## Overview

**v1.6.3** focuses on comprehensive documentation and diagnostics for Collections API permissions issues. This release includes complete troubleshooting guides, automated diagnostic tools, and fixes for edge cases in collection operations.

**Release Date:** January 27, 2026  
**Previous Release:** [v1.6.2](v1.6.2.md) (January 27, 2026)

---

## Key Features

### ğŸ†• Collections API Diagnostics & Documentation

#### New Documentation Files
1. **[COLLECTIONS_PERMISSIONS.md](../doc/COLLECTIONS_PERMISSIONS.md)** (English)
   - Comprehensive 300+ line guide
   - Complete Azure RBAC and Purview Data Plane role requirements
   - Step-by-step setup scripts for PowerShell and Bash
   - Detailed troubleshooting for HTTP 403 errors
   - Verification commands and network connectivity tests

2. **[COLLECTIONS_PERMISSIONS_FR.md](../doc/COLLECTIONS_PERMISSIONS_FR.md)** (French)
   - Quick reference guide in French
   - Condensed permission checklist
   - Common issues and solutions table
   - Access to full English documentation

3. **[FIX_COLLECTIONS_CREATE_403.md](../doc/FIX_COLLECTIONS_CREATE_403.md)** (French Quick Fix)
   - 5-step solution for HTTP 403 errors
   - Rapid diagnosis checklist
   - Links to comprehensive guides

#### New Diagnostic Tools
1. **[diagnose_collections_permissions.ps1](../scripts/diagnose_collections_permissions.ps1)** (PowerShell)
   - Automated diagnostics for Windows/PowerShell environments
   - Tests Azure CLI, authentication, Azure RBAC roles, Purview permissions
   - Provides specific recommendations based on findings
   - Colored output for easy reading
   - Network connectivity verification

2. **[diagnose_collections_permissions.py](../scripts/diagnose_collections_permissions.py)** (Python)
   - Cross-platform diagnostic tool
   - Same comprehensive checks as PowerShell version
   - Works on macOS, Linux, and Windows
   - JSON parsing for detailed error analysis
   - Timeout protection for all network operations

### ğŸ”§ Bug Fixes

#### Collections get-details Command
- **Fixed:** Parameter name inconsistency (`--name` â†’ `--collectionName`)
- **Fixed:** Invalid field references in response parsing
  - Removed reference to non-existent `collectionId` field
  - Now uses `collectionProvisioningState` (actual API field)
  - Improved parent collection extraction with fallback logic
- **Result:** `pvw collections get-details <name>` now displays populated data correctly

---

## What's Included in v1.6.3

### Documentation (4 Files)
```
doc/
â”œâ”€â”€ COLLECTIONS_PERMISSIONS.md          # 300+ lines comprehensive guide (EN)
â”œâ”€â”€ COLLECTIONS_PERMISSIONS_FR.md       # French quick reference
â”œâ”€â”€ FIX_COLLECTIONS_CREATE_403.md       # French 5-step quick fix
â””â”€â”€ (Updated in v1.6.2): COLLECTIONS_PERMISSIONS.md
```

### Diagnostic Tools (2 Scripts)
```
scripts/
â”œâ”€â”€ diagnose_collections_permissions.ps1  # PowerShell diagnostic
â””â”€â”€ diagnose_collections_permissions.py   # Python diagnostic
```

### Code Fixes
```
purviewcli/cli/collections.py
â”œâ”€â”€ Fixed get-details parameter handling
â”œâ”€â”€ Fixed field mapping for collection info display
â””â”€â”€ Improved error messages
```

---

## Permission Requirements Clarification

This release clarifies that Collections API requires **TWO LEVELS** of permissions:

### Level 1: Azure RBAC (Subscription)
- **Required Role:** `Contributor` or `Owner`
- **Scope:** Purview Account resource
- **Check:** `az role assignment list --assignee-object-id <SP_OBJECT_ID>`

### Level 2: Purview Data Plane
- **Required Role:** `Purview Data Source Administrator` or `Collection Administrator`
- **Assignment:** Via Azure Portal > Purview Account > Access Control (IAM)
- **Check:** Run diagnostic tool or `pvw collections list`

**Common Issue:** Having only one level causes HTTP 403 errors

---

## New Diagnostic Capabilities

### PowerShell Users
```powershell
./scripts/diagnose_collections_permissions.ps1
```

Checks:
- âœ“ Azure CLI installed
- âœ“ Authenticated to Azure
- âœ“ Service Principal environment variables set
- âœ“ Purview account exists
- âœ“ Azure RBAC roles assigned
- âœ“ Purview Data Plane roles assigned
- âœ“ Network connectivity to Azure endpoints

### Python Users (All Platforms)
```bash
python scripts/diagnose_collections_permissions.py
```

Same comprehensive checks, works on macOS, Linux, and Windows.

---

## Usage Examples

### Verify Collections Permissions
```bash
# Quick check
pvw collections list

# Full diagnostic
./scripts/diagnose_collections_permissions.ps1
# OR
python scripts/diagnose_collections_permissions.py
```

### Create Collection (After Permission Setup)
```bash
pvw collections create \
  --collection-name "my-collection" \
  --friendly-name "My Collection" \
  --description "Test collection"
```

### Get Collection Details
```bash
pvw collections get-details my-collection
```

Expected output (now populated):
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ Property         â”ƒ Value           â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ Name             â”‚ my-collection   â”‚
â”‚ Display Name     â”‚ My Collection   â”‚
â”‚ Description      â”‚ Test collection â”‚
â”‚ Provisioning... | Succeeded       â”‚
â”‚ Parent Collectionâ”‚ root            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Technical Details

### Dependencies
- No new Python dependencies added
- Diagnostic tools use only standard library and Azure CLI
- PowerShell 5.1+ (Windows) or PowerShell Core 7+ (all platforms)

### Backward Compatibility
- âœ… All existing commands remain unchanged
- âœ… All existing permissions continue to work
- âœ… Collections API fully conformant with Microsoft spec
- âœ… No breaking changes

### Performance Impact
- Diagnostic tools run quickly (typically < 30 seconds)
- Network tests include timeout protection
- No impact on regular CLI operations

---

## Migration from v1.6.2

For users upgrading from v1.6.2:

1. **No action required** - All v1.6.2 functionality preserved
2. **Optionally review** - Check `doc/COLLECTIONS_PERMISSIONS_FR.md` for permission setup
3. **Run diagnostics** if experiencing HTTP 403 errors
4. **Update references** - README now points to collections diagnostics

---

## Known Limitations

1. **Purview Role Assignment** requires Azure Portal or Azure CLI
   - No direct Python API available yet
   - Recommended: Use Portal for visibility

2. **Permission Propagation** takes 5-10 minutes
   - Azure-side limitation
   - Documented in guides

3. **Service Principal Registration**
   - Some legacy Azure tenants require manual SP registration
   - Documented in troubleshooting guide

---

## Support & Troubleshooting

### Common Issues

| Issue | Solution |
|-------|----------|
| HTTP 403 when creating collections | See [FIX_COLLECTIONS_CREATE_403.md](../doc/FIX_COLLECTIONS_CREATE_403.md) |
| Diagnostic reports permission missing | Check [COLLECTIONS_PERMISSIONS.md](../doc/COLLECTIONS_PERMISSIONS.md) |
| Permissions still not working after setup | Wait 5-10 minutes, then `az logout && az login` |

### Getting Help

1. Run the diagnostic tool (PowerShell or Python)
2. Review [COLLECTIONS_PERMISSIONS_FR.md](../doc/COLLECTIONS_PERMISSIONS_FR.md) (French) or [COLLECTIONS_PERMISSIONS.md](../doc/COLLECTIONS_PERMISSIONS.md) (English)
3. Check the specific issue in troubleshooting section
4. Enable debug logging: `export LOGLEVEL=DEBUG` or `$env:LOGLEVEL = 'DEBUG'`

---

## Files Changed

### New Files (6)
- `doc/COLLECTIONS_PERMISSIONS.md` (326 lines)
- `doc/COLLECTIONS_PERMISSIONS_FR.md` (123 lines)
- `doc/FIX_COLLECTIONS_CREATE_403.md` (172 lines)
- `scripts/diagnose_collections_permissions.ps1` (424 lines)
- `scripts/diagnose_collections_permissions.py` (418 lines)
- `releases/v1.6.3.md` (this file)

### Modified Files (2)
- `pyproject.toml` (version bump)
- `purviewcli/__init__.py` (version bump)
- `purviewcli/cli/collections.py` (get-details bug fixes)

---

## Release Commits

```
332add43 - docs: Add quick fix guide for Collections create HTTP 403 errors in French
c354c4e1 - docs: Add comprehensive Collections API permissions & diagnostics documentation
69bd2406 - fix: collections get-details command - fix parameter names and field mappings
11d2c587 - docs: Update README.md for v1.6.2 - Collections API Conformance as primary feature
ebd2f3e7 - chore: Release v1.6.2 - Collections API Conformance Update
```

---

## Testing

All changes tested with:
- âœ… Azure CLI (latest)
- âœ… PowerShell 7.x
- âœ… Python 3.8+
- âœ… Windows, macOS, Linux

---

## Contributors

- **AYOUB KEBAILI** - Primary maintainer

---

## License

MIT License - See LICENSE file for details

---

## What's Next

### Planned for v1.7.0
- [ ] Direct Purview role assignment via CLI
- [ ] Enhanced permission caching
- [ ] Support for hierarchical permissions
- [ ] Advanced collection analytics

### Community Feedback Welcome
- Issues: https://github.com/Keayoub/pvw-cli/issues
- Discussions: https://github.com/Keayoub/pvw-cli/discussions

---

## Thank You

Thank you for using PVW CLI! Your feedback helps us improve.

For questions or issues, please reach out:
- **Email:** keayoub@msn.com
- **GitHub:** https://github.com/Keayoub/pvw-cli

---

**Happy Purview automating! ğŸ‰**
