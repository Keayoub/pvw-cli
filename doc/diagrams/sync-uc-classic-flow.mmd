```mermaid
flowchart TD
    Start([DÃ©marrage: pvw uc term sync-classic]) --> CheckParams{ParamÃ¨tres<br/>valides?}
    
    CheckParams -->|Non| ErrorParams[Erreur: ParamÃ¨tres manquants]
    CheckParams -->|Oui| FetchUCTerms[RÃ©cupÃ©rer les termes UC<br/>du domaine]
    
    FetchUCTerms --> HasTerms{Termes<br/>trouvÃ©s?}
    HasTerms -->|Non| WarnNoTerms[Avertissement: Aucun terme]
    HasTerms -->|Oui| DetermineGlossary{Glossaire<br/>spÃ©cifiÃ©?}
    
    DetermineGlossary -->|Oui| UseSpecified[Utiliser le glossaire<br/>spÃ©cifiÃ©]
    DetermineGlossary -->|Non| SearchByName[Rechercher glossaire<br/>par nom de domaine]
    
    SearchByName --> GlossaryFound{Glossaire<br/>trouvÃ©?}
    GlossaryFound -->|Oui| UseFound[Utiliser le glossaire<br/>trouvÃ©]
    GlossaryFound -->|Non| CheckCreate{--create-glossary<br/>activÃ©?}
    
    CheckCreate -->|Non| ErrorNoGlossary[Erreur: Aucun glossaire cible]
    CheckCreate -->|Oui| CreateGlossary{Dry-run?}
    
    CreateGlossary -->|Oui| ShowWouldCreate[Afficher: Would create<br/>glossary]
    CreateGlossary -->|Non| DoCreate[CrÃ©er le glossaire]
    
    UseSpecified --> FetchExisting[RÃ©cupÃ©rer les termes<br/>existants du glossaire]
    UseFound --> FetchExisting
    DoCreate --> FetchExisting
    ShowWouldCreate --> FetchExisting
    
    FetchExisting --> ProcessTerms[Traiter chaque terme UC]
    
    ProcessTerms --> CheckExists{Terme<br/>existe?}
    
    CheckExists -->|Non| CheckDryRun1{Dry-run?}
    CheckExists -->|Oui| CheckUpdate{--update-existing<br/>activÃ©?}
    
    CheckUpdate -->|Non| Skip[âŠ– Ignorer le terme]
    CheckUpdate -->|Oui| CheckDryRun2{Dry-run?}
    
    CheckDryRun1 -->|Oui| ShowWouldCreate2[Afficher: Would create]
    CheckDryRun1 -->|Non| CreateTerm[âœ“ CrÃ©er le terme]
    
    CheckDryRun2 -->|Oui| ShowWouldUpdate[Afficher: Would update]
    CheckDryRun2 -->|Non| UpdateTerm[âœ“ Mettre Ã  jour]
    
    CreateTerm --> CountStats
    UpdateTerm --> CountStats
    Skip --> CountStats
    ShowWouldCreate2 --> CountStats
    ShowWouldUpdate --> CountStats
    
    CountStats{Plus de<br/>termes?} -->|Oui| ProcessTerms
    CountStats -->|Non| GenerateReport[GÃ©nÃ©rer le rapport<br/>de synchronisation]
    
    GenerateReport --> ShowSummary[Afficher le rÃ©sumÃ©:<br/>- Total UC Terms<br/>- Created<br/>- Updated<br/>- Skipped<br/>- Failed]
    
    ShowSummary --> CheckDryRunFinal{Dry-run?}
    CheckDryRunFinal -->|Oui| ShowDryRunNote[ğŸ’¡ Dry run - aucune<br/>modification appliquÃ©e]
    CheckDryRunFinal -->|Non| CheckSuccess{Ã‰checs?}
    
    CheckSuccess -->|Oui| ErrorSummary[âš  Synchronisation<br/>avec erreurs]
    CheckSuccess -->|Non| SuccessSummary[âœ… Synchronisation<br/>rÃ©ussie!]
    
    ShowDryRunNote --> End([Fin])
    ErrorSummary --> End
    SuccessSummary --> End
    ErrorParams --> End
    WarnNoTerms --> End
    ErrorNoGlossary --> End
    
    style Start fill:#0078D4,stroke:#004578,color:#fff
    style End fill:#0078D4,stroke:#004578,color:#fff
    style CreateTerm fill:#28a745,stroke:#1e7e34,color:#fff
    style UpdateTerm fill:#ffc107,stroke:#d39e00,color:#000
    style Skip fill:#6c757d,stroke:#545b62,color:#fff
    style ErrorParams fill:#dc3545,stroke:#bd2130,color:#fff
    style ErrorNoGlossary fill:#dc3545,stroke:#bd2130,color:#fff
    style ErrorSummary fill:#dc3545,stroke:#bd2130,color:#fff
    style SuccessSummary fill:#28a745,stroke:#1e7e34,color:#fff
    style ShowDryRunNote fill:#ffc107,stroke:#d39e00,color:#000
```

## LÃ©gende

### Ã‰tats du processus

- ğŸ”µ **Bleu** : DÃ©but/Fin du processus
- ğŸŸ¢ **Vert** : OpÃ©ration de crÃ©ation rÃ©ussie
- ğŸŸ¡ **Jaune** : OpÃ©ration de mise Ã  jour
- âš« **Gris** : Terme ignorÃ© (skip)
- ğŸ”´ **Rouge** : Erreur

### Symboles

- **Rectangle arrondi** : DÃ©but/Fin
- **Rectangle** : Action/OpÃ©ration
- **Losange** : DÃ©cision/Condition
- **FlÃ¨che** : Flux du processus

## ScÃ©narios dÃ©taillÃ©s

### ScÃ©nario 1 : PremiÃ¨re synchronisation (sans glossaire existant)

```
Start â†’ ParamÃ¨tres OK â†’ RÃ©cupÃ©rer termes UC (15 termes)
â†’ Aucun glossaire trouvÃ© â†’ --create-glossary activÃ©
â†’ CrÃ©er nouveau glossaire "Sales" â†’ RÃ©cupÃ©rer existants (0 termes)
â†’ CrÃ©er terme 1 â†’ CrÃ©er terme 2 â†’ ... â†’ CrÃ©er terme 15
â†’ RÃ©sumÃ©: 15 crÃ©Ã©s, 0 mis Ã  jour, 0 ignorÃ©s, 0 Ã©checs
â†’ âœ… SuccÃ¨s
```

### ScÃ©nario 2 : Synchronisation avec glossaire existant

```
Start â†’ ParamÃ¨tres OK â†’ RÃ©cupÃ©rer termes UC (20 termes)
â†’ Glossaire "Sales" trouvÃ© â†’ RÃ©cupÃ©rer existants (10 termes)
â†’ Traiter termes:
  - Termes 1-10: IgnorÃ©s (dÃ©jÃ  existants)
  - Termes 11-20: CrÃ©Ã©s
â†’ RÃ©sumÃ©: 10 crÃ©Ã©s, 0 mis Ã  jour, 10 ignorÃ©s, 0 Ã©checs
â†’ âœ… SuccÃ¨s
```

### ScÃ©nario 3 : Mise Ã  jour de termes existants

```
Start â†’ ParamÃ¨tres OK avec --update-existing
â†’ RÃ©cupÃ©rer termes UC (15 termes)
â†’ Glossaire trouvÃ© â†’ RÃ©cupÃ©rer existants (15 termes)
â†’ Traiter termes:
  - Tous les 15 termes: Mis Ã  jour
â†’ RÃ©sumÃ©: 0 crÃ©Ã©s, 15 mis Ã  jour, 0 ignorÃ©s, 0 Ã©checs
â†’ âœ… SuccÃ¨s
```

### ScÃ©nario 4 : Dry-run (prÃ©visualisation)

```
Start â†’ ParamÃ¨tres OK avec --dry-run
â†’ RÃ©cupÃ©rer termes UC (10 termes)
â†’ Glossaire trouvÃ© â†’ RÃ©cupÃ©rer existants (5 termes)
â†’ Traiter termes:
  - Termes 1-5: Would update (si --update-existing)
  - Termes 6-10: Would create
â†’ RÃ©sumÃ© avec note "This was a dry run"
â†’ ğŸ’¡ Aucune modification appliquÃ©e
```

### ScÃ©nario 5 : Erreur - Aucun glossaire

```
Start â†’ ParamÃ¨tres OK (sans --create-glossary)
â†’ RÃ©cupÃ©rer termes UC (10 termes)
â†’ Aucun glossaire trouvÃ©
â†’ âŒ Erreur: No target glossary found
```

## Points de dÃ©cision clÃ©s

### 1. DÃ©termination du glossaire cible

```
Si --glossary-guid fourni:
    Utiliser ce glossaire
Sinon:
    Rechercher par nom de domaine
    Si trouvÃ©:
        Utiliser ce glossaire
    Sinon si --create-glossary:
        CrÃ©er nouveau glossaire
    Sinon:
        Erreur
```

### 2. Traitement d'un terme

```
Pour chaque terme UC:
    Si terme existe dans glossaire classique:
        Si --update-existing:
            Mettre Ã  jour le terme
        Sinon:
            Ignorer le terme
    Sinon:
        CrÃ©er nouveau terme
```

### 3. Mode dry-run

```
Si --dry-run:
    Afficher "Would create" ou "Would update"
    Ne pas modifier les donnÃ©es
    IncrÃ©menter les compteurs
Sinon:
    ExÃ©cuter l'action rÃ©elle
    IncrÃ©menter les compteurs
```

## Gestion des erreurs

### Points d'erreur possibles

1. **ParamÃ¨tres invalides**
   - Domaine ID manquant ET glossaire GUID manquant
   - Format GUID invalide

2. **API Purview**
   - Authentification Ã©chouÃ©e
   - Permissions insuffisantes
   - Timeout de connexion

3. **Glossaire**
   - Glossaire non trouvÃ© (sans --create-glossary)
   - Ã‰chec de crÃ©ation de glossaire

4. **Termes**
   - Ã‰chec de crÃ©ation/mise Ã  jour d'un terme
   - Format de donnÃ©es invalide

### StratÃ©gie de gestion

- **Erreurs critiques** : ArrÃªt du processus
- **Erreurs de terme individuel** : Continuer avec les autres termes
- **Compteur d'Ã©checs** : Suivre le nombre de termes en Ã©chec
- **Logs dÃ©taillÃ©s** : Enregistrer toutes les erreurs

## Optimisations

### Performances

1. **RÃ©cupÃ©ration en lot** : Tous les termes UC en une seule requÃªte
2. **Cache local** : Termes existants chargÃ©s une fois
3. **Traitement sÃ©quentiel** : Un terme Ã  la fois (Ã©vite les conflits)

### FiabilitÃ©

1. **Validation prÃ©alable** : VÃ©rifier les paramÃ¨tres avant traitement
2. **Dry-run par dÃ©faut** : Encourager la prÃ©visualisation
3. **Statistiques dÃ©taillÃ©es** : Transparence sur les actions effectuÃ©es
4. **Mode debug** : Logging Ã©tendu pour troubleshooting
